<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Token ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-top: 10px;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .output {
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            word-break: break-all;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .info {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 13px;
        }

        .flex-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .flex-row .btn {
            margin-top: 0;
        }

        .jwt-part {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }

        .jwt-header {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .jwt-payload {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .jwt-signature {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .jwt-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .jwt-decoded {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin-top: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” JWT Token ç”Ÿæˆå™¨èˆ‡é©—è­‰å™¨</h1>

        <!-- JWT Secret è¨­å®š -->
        <div class="section">
            <h2>JWT Secret Key (ç”¨ä¾†ç°½åå’Œé©—è­‰çš„å¯†é‘°)</h2>
            <div class="input-group">
                <label>Secret Key (æœ€å°‘ 32 å­—ç¬¦)</label>
                <input type="text" id="secretKey" value="" placeholder="your-secret-key-min-32-chars (è¼¸å…¥æˆ–é»æ“Šéš¨æ©Ÿç”Ÿæˆ)">
            </div>
            <div class="flex-row">
                <button class="btn" onclick="generateRandomSecret('base64')">éš¨æ©Ÿç”Ÿæˆ (Base64URL)</button>
                <button class="btn" onclick="generateRandomSecret('hex')">éš¨æ©Ÿç”Ÿæˆ (Hex)</button>
                <button class="btn" onclick="copySecret()">è¤‡è£½ Secret Key</button>
            </div>
            <div class="info">
                ğŸ’¡ Secret key åƒ…åœ¨æœ¬åœ°ç€è¦½å™¨ä¸­ä½¿ç”¨ï¼Œä¸æœƒç™¼é€åˆ°ä»»ä½•ä¼ºæœå™¨ã€‚å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œä½†å»ºè­°ä½¿ç”¨è‡³å°‘ 256-bit å¼·åº¦çš„éš¨æ©Ÿå­—ä¸²ï¼ˆBase64URL æˆ– Hex æ ¼å¼ï¼‰ã€‚
            </div>
        </div>

        <!-- JWT ç”Ÿæˆ -->
        <div class="section">
            <h2>ç”Ÿæˆ JWT Token</h2>
            <div class="input-group">
                <label>Payload (JSON æ ¼å¼)</label>
                <textarea id="payload" placeholder='{"userId": "123", "username": "user", "role": "admin"}'>{"userId": "123", "username": "user", "role": "admin"}</textarea>
            </div>
            <div class="input-group">
                <label>éæœŸæ™‚é–“ (ç§’ï¼Œé¸å¡«)</label>
                <input type="number" id="expiresIn" placeholder="ä¾‹å¦‚: 3600 (1å°æ™‚)" value="3600">
            </div>
            <button class="btn" onclick="generateJWT()">ç”Ÿæˆ JWT</button>
            <button class="btn" onclick="copyToken()">è¤‡è£½ JWT</button>

            <div class="input-group" style="margin-top: 15px;">
                <label>ç”Ÿæˆçš„ JWT Token</label>
                <div class="output" id="generatedToken">é»æ“Šç”ŸæˆæŒ‰éˆ•...</div>
            </div>
        </div>

        <!-- JWT é©—è­‰èˆ‡è§£ç¢¼ -->
        <div class="section">
            <h2>é©—è­‰èˆ‡è§£ç¢¼ JWT Token</h2>
            <div class="input-group">
                <label>JWT Token</label>
                <textarea id="tokenToVerify" placeholder="è²¼ä¸Šè¦é©—è­‰æˆ–è§£ç¢¼çš„ JWT token"></textarea>
            </div>
            <button class="btn" onclick="verifyJWT()">é©—è­‰ JWT (éœ€è¦ Secret Key)</button>
            <button class="btn" onclick="decodeJWT()">è§£ç¢¼ JWT (ä¸éœ€è¦ Secret Key)</button>
            <div class="input-group" style="margin-top: 15px;">
                <label>çµæœ</label>
                <div class="output" id="verifyResult">ç­‰å¾…æ“ä½œ...</div>
            </div>
        </div>
    </div>

    <script>
        // Base64 URL ç·¨ç¢¼/è§£ç¢¼
        function base64UrlEncode(buffer) {
            return btoa(String.fromCharCode.apply(null, new Uint8Array(buffer)))
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=+$/, '');
        }

        function base64UrlDecode(str) {
            str = str.replace(/-/g, '+').replace(/_/g, '/');
            while (str.length % 4) {
                str += '=';
            }
            return Uint8Array.from(atob(str), c => c.charCodeAt(0));
        }

        // HMAC-SHA256 ç°½å
        async function hmacSHA256(message, secret) {
            const encoder = new TextEncoder();
            const keyData = encoder.encode(secret);
            const messageData = encoder.encode(message);

            const key = await crypto.subtle.importKey(
                'raw',
                keyData,
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign', 'verify']
            );

            const signature = await crypto.subtle.sign('HMAC', key, messageData);
            return base64UrlEncode(signature);
        }

        // éš¨æ©Ÿç”Ÿæˆ Secret Keyï¼ˆæ”¯æŒ Base64URL å’Œ Hexï¼‰
        function generateRandomSecret(format = 'base64') {
            const array = new Uint8Array(32); // 32 bytes = 256 bits
            crypto.getRandomValues(array);    // ç€è¦½å™¨å®‰å…¨éš¨æ©Ÿæ•¸

            let result = '';

            if (format === 'hex') {
                // è½‰æ›ç‚º Hex æ ¼å¼ (64 å€‹å­—ç¬¦)
                for (let i = 0; i < array.length; i++) {
                    result += array[i].toString(16).padStart(2, '0');
                }
            } else {
                // è½‰æ›ç‚º Base64URL æ ¼å¼ (ç´„ 43 å€‹å­—ç¬¦)
                let binary = "";
                for (let i = 0; i < array.length; i++) {
                    binary += String.fromCharCode(array[i]);
                }
                result = btoa(binary)
                    .replace(/\+/g, "-")
                    .replace(/\//g, "_")
                    .replace(/=+$/, "");
            }

            document.getElementById("secretKey").value = result;
        }

        // è¤‡è£½ Secret
        function copySecret() {
            const input = document.getElementById("secretKey");
            if (!input.value) {
                alert('è«‹å…ˆè¼¸å…¥æˆ–ç”Ÿæˆ Secret Keyï¼');
                return;
            }
            input.select();
            document.execCommand("copy");
            alert('å·²è¤‡è£½ Secret Keyï¼');
        }

        // è¤‡è£½ JWT
        function copyToken() {
            const tokenDiv = document.getElementById("generatedToken");
            const text = tokenDiv.textContent.trim();

            // æå– JWT token (æ ¼å¼: xxx.yyy.zzz)
            const jwtMatch = text.match(/[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+/);

            if (jwtMatch) {
                const el = document.createElement("textarea");
                el.value = jwtMatch[0];
                document.body.appendChild(el);
                el.select();
                document.execCommand("copy");
                document.body.removeChild(el);
                alert('å·²è¤‡è£½ JWT Tokenï¼');
            } else {
                alert('å°šæœªç”Ÿæˆ JWT Tokenï¼');
            }
        }

        // ç”Ÿæˆ JWT
        async function generateJWT() {
            try {
                const secret = document.getElementById('secretKey').value;
                const payloadStr = document.getElementById('payload').value;
                const expiresIn = document.getElementById('expiresIn').value;

                if (!secret) {
                    alert('è«‹å…ˆè¼¸å…¥æˆ–ç”Ÿæˆ Secret Keyï¼');
                    return;
                }

                if (secret.length < 32) {
                    alert('Secret key å¿…é ˆè‡³å°‘ 32 å€‹å­—ç¬¦ï¼');
                    return;
                }

                let payload = JSON.parse(payloadStr);

                const now = Math.floor(Date.now() / 1000);
                payload.iat = now;
                if (expiresIn && expiresIn > 0) {
                    payload.exp = now + parseInt(expiresIn);
                }

                const header = {
                    alg: 'HS256',
                    typ: 'JWT'
                };

                const encoder = new TextEncoder();
                const encodedHeader = base64UrlEncode(encoder.encode(JSON.stringify(header)));
                const encodedPayload = base64UrlEncode(encoder.encode(JSON.stringify(payload)));

                const signatureInput = encodedHeader + '.' + encodedPayload;
                const signature = await hmacSHA256(signatureInput, secret);

                const jwt = signatureInput + '.' + signature;

                // åªé¡¯ç¤ºå®Œæ•´ JWT
                document.getElementById('generatedToken').innerHTML = 
                    '<span class="success">âœ“ æˆåŠŸç”Ÿæˆ</span><br><br>' + jwt;

            } catch (error) {
                document.getElementById('generatedToken').innerHTML = 
                    '<span class="error">âœ— éŒ¯èª¤: ' + error.message + '</span>';
            }
        }

        // é©—è­‰ JWTï¼ˆéœ€è¦ Secret Keyï¼‰
        async function verifyJWT() {
            try {
                const secret = document.getElementById('secretKey').value;
                const token = document.getElementById('tokenToVerify').value.trim();

                if (!secret) {
                    alert('è«‹å…ˆè¼¸å…¥ Secret Keyï¼é©—è­‰åŠŸèƒ½éœ€è¦ Secret Keyã€‚\nå¦‚æœåªæƒ³æŸ¥çœ‹ Token å…§å®¹ï¼Œè«‹ä½¿ç”¨ã€Œè§£ç¢¼ JWTã€åŠŸèƒ½ã€‚');
                    return;
                }

                if (!token) {
                    alert('è«‹è¼¸å…¥ JWT tokenï¼');
                    return;
                }

                const parts = token.split('.');
                if (parts.length !== 3) {
                    throw new Error('ç„¡æ•ˆçš„ JWT æ ¼å¼');
                }

                const signatureInput = parts[0] + '.' + parts[1];
                const expectedSignature = await hmacSHA256(signatureInput, secret);

                if (expectedSignature !== parts[2]) {
                    throw new Error('ç°½åé©—è­‰å¤±æ•—ï¼Token å¯èƒ½è¢«ç¯¡æ”¹æˆ–ä½¿ç”¨äº†éŒ¯èª¤çš„ secret key');
                }

                const header = JSON.parse(
                    new TextDecoder().decode(base64UrlDecode(parts[0]))
                );
                const payload = JSON.parse(
                    new TextDecoder().decode(base64UrlDecode(parts[1]))
                );

                const now = Math.floor(Date.now() / 1000);
                let expStatus = '';
                if (payload.exp) {
                    if (now > payload.exp) {
                        expStatus = '<br><span class="error">âš  Token å·²éæœŸ</span>';
                    } else {
                        const remaining = payload.exp - now;
                        expStatus = '<br><span class="success">âœ“ Token æœ‰æ•ˆï¼Œå‰©é¤˜ ' + remaining + ' ç§’</span>';
                    }
                }

                let output = '<span class="success">âœ“ ç°½åé©—è­‰æˆåŠŸ</span>' + expStatus + '<br><br>';

                output += '<strong>Header:</strong><br>' + JSON.stringify(header, null, 2);
                output += '<br><br><strong>Payload:</strong><br>' + JSON.stringify(payload, null, 2);

                document.getElementById('verifyResult').innerHTML = output;

            } catch (error) {
                document.getElementById('verifyResult').innerHTML = 
                    '<span class="error">âœ— é©—è­‰å¤±æ•—: ' + error.message + '</span>';
            }
        }

        // è§£ç¢¼ JWT (ä¸é©—è­‰ï¼Œä¸éœ€è¦ Secret Key) - åŒ…å«å®Œæ•´çµæ§‹è§£æ
        function decodeJWT() {
            try {
                const token = document.getElementById('tokenToVerify').value.trim();

                if (!token) {
                    alert('è«‹è¼¸å…¥ JWT tokenï¼');
                    return;
                }

                const parts = token.split('.');
                if (parts.length !== 3) {
                    throw new Error('ç„¡æ•ˆçš„ JWT æ ¼å¼');
                }

                const header = JSON.parse(
                    new TextDecoder().decode(base64UrlDecode(parts[0]))
                );
                const payload = JSON.parse(
                    new TextDecoder().decode(base64UrlDecode(parts[1]))
                );

                let output = '<strong>ğŸ“‹ JWT çµæ§‹è§£æ (ä¸‰éƒ¨åˆ†ç”¨ . åˆ†éš”):</strong><br><br>';

                // Header éƒ¨åˆ† - å®Œæ•´èªªæ˜
                output += '<div class="jwt-part jwt-header">';
                output += '<div class="jwt-label">ğŸŸ¡ ç¬¬ä¸€éƒ¨åˆ†: Header (æ¨™é ­)</div>';
                output += '<strong>Base64URL ç·¨ç¢¼:</strong> ' + parts[0];
                output += '<div class="jwt-decoded"><strong>è§£ç¢¼å¾Œ:</strong><br>' + JSON.stringify(header, null, 2) + '</div>';
                output += '<div style="font-size: 11px; color: #666; margin-top: 5px;">ğŸ’¡ èªªæ˜ï¼šHeader å®šç¾©äº† Token çš„é¡å‹ (typ) å’Œä½¿ç”¨çš„ç°½åç®—æ³• (alg)ã€‚é€™éƒ¨åˆ†åªæ˜¯ Base64URL ç·¨ç¢¼ï¼Œä»»ä½•äººéƒ½èƒ½è§£ç¢¼æŸ¥çœ‹ã€‚</div>';
                output += '</div>';

                // Payload éƒ¨åˆ† - å®Œæ•´èªªæ˜
                output += '<div class="jwt-part jwt-payload">';
                output += '<div class="jwt-label">ğŸ”µ ç¬¬äºŒéƒ¨åˆ†: Payload (è² è¼‰)</div>';
                output += '<strong>Base64URL ç·¨ç¢¼:</strong> ' + parts[1];
                output += '<div class="jwt-decoded"><strong>è§£ç¢¼å¾Œ:</strong><br>' + JSON.stringify(payload, null, 2) + '</div>';
                output += '<div style="font-size: 11px; color: #666; margin-top: 5px;">ğŸ’¡ èªªæ˜ï¼šPayload åŒ…å«å¯¦éš›çš„ç”¨æˆ¶æ•¸æ“šå’Œæ¨™æº–è²æ˜ã€‚å¸¸è¦‹æ¬„ä½ï¼š<br>';
                output += 'â€¢ <strong>iat</strong> (issued at): Token ç°½ç™¼æ™‚é–“ (Unix æ™‚é–“æˆ³)<br>';
                output += 'â€¢ <strong>exp</strong> (expiration): Token éæœŸæ™‚é–“ (Unix æ™‚é–“æˆ³)<br>';
                output += 'â€¢ å…¶ä»–è‡ªå®šç¾©æ•¸æ“š (å¦‚ userId, username, role ç­‰)<br>';
                output += 'âš ï¸ Payload ä¹Ÿåªæ˜¯ Base64URL ç·¨ç¢¼ï¼Œä¸è¦åœ¨é€™è£¡å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç¢¼ï¼‰ï¼</div>';
                output += '</div>';

                // Signature éƒ¨åˆ† - å®Œæ•´èªªæ˜
                output += '<div class="jwt-part jwt-signature">';
                output += '<div class="jwt-label">ğŸ”´ ç¬¬ä¸‰éƒ¨åˆ†: Signature (ç°½å)</div>';
                output += '<strong>ç°½åå€¼:</strong> ' + parts[2];
                output += '<div style="font-size: 11px; color: #666; margin-top: 8px;">ğŸ’¡ èªªæ˜ï¼šSignature æ˜¯ä½¿ç”¨ Secret Key å°å‰å…©éƒ¨åˆ† (Header.Payload) é€²è¡Œ HMAC-SHA256 ç°½åçš„çµæœã€‚<br><br>';
                output += '<strong>è¨ˆç®—å…¬å¼:</strong><br>';
                output += '<code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 4px;">';
                output += 'HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)';
                output += '</code><br><br>';
                output += 'ğŸ”’ <strong>å®‰å…¨æ€§ï¼š</strong>åªæœ‰æŒæœ‰æ­£ç¢º Secret Key çš„äººæ‰èƒ½ç”Ÿæˆæˆ–é©—è­‰æœ‰æ•ˆçš„ç°½åã€‚å¦‚æœæœ‰äººä¿®æ”¹äº† Header æˆ– Payloadï¼Œç°½åå°±æœƒå°ä¸ä¸Šï¼Œç¢ºä¿ Token æœªè¢«ç¯¡æ”¹ã€‚<br><br>';
                output += 'âš ï¸ <strong>æ³¨æ„ï¼š</strong>æ­¤è™•åƒ…é¡¯ç¤ºç°½åå€¼ï¼Œæœªé©—è­‰å…¶æœ‰æ•ˆæ€§ã€‚è‹¥è¦é©—è­‰ç°½åï¼Œè«‹ä½¿ç”¨ã€Œé©—è­‰ JWTã€åŠŸèƒ½ã€‚</div>';
                output += '</div>';

                // ç¸½çµèªªæ˜
                output += '<div class="info" style="background: #fff3cd; border-left-color: #ffc107; margin-top: 15px;">';
                output += 'ğŸ“Œ <strong>JWT å®‰å…¨æ©Ÿåˆ¶ç¸½çµï¼š</strong><br>';
                output += 'â€¢ <strong>ç·¨ç¢¼ â‰  åŠ å¯†ï¼š</strong>Header å’Œ Payload åªæ˜¯ Base64URL ç·¨ç¢¼ï¼Œä»»ä½•äººéƒ½èƒ½è§£ç¢¼æŸ¥çœ‹<br>';
                output += 'â€¢ <strong>å®‰å…¨ä¾†è‡ªç°½åï¼š</strong>Signature ä½¿ç”¨ Secret Key ç°½åï¼Œé˜²æ­¢ç¯¡æ”¹<br>';
                output += 'â€¢ <strong>å®Œæ•´æ€§ä¿è­‰ï¼š</strong>ä¿®æ”¹ä»»ä½•éƒ¨åˆ†éƒ½æœƒå°è‡´ç°½åé©—è­‰å¤±æ•—<br>';
                output += 'â€¢ <strong>ä½¿ç”¨å»ºè­°ï¼š</strong>ä¸è¦åœ¨ Payload ä¸­å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼ŒSecret Key å¿…é ˆä¿å¯†';
                output += '</div>';

                document.getElementById('verifyResult').innerHTML = output;

            } catch (error) {
                document.getElementById('verifyResult').innerHTML = 
                    '<span class="error">âœ— è§£ç¢¼å¤±æ•—: ' + error.message + '</span>';
            }
        }
    </script>
</body>
</html>