<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæ‰¹é‡è«‹æ±‚å™¨ (é€²éšç‰ˆ)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #059669;
            --danger-color: #dc2626;
            --warning-color: #d97706;
            --info-color: #0891b2;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            --gradient-warning: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            --gradient-danger: linear-gradient(135deg, #f87171 0%, #ef4444 100%);

            /* ä¸»é …è¡¨æ ¼ - ç²‰è—è‰²ç³» */
            --main-primary: #3b82f6;
            --main-primary-hover: #2563eb;
            --main-light: #dbeafe;
            --main-lighter: #eff6ff;
            --main-gradient: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);

            /* åƒæ•¸çµ„è¡¨æ ¼ - ç²‰ç´«è‰²ç³» */
            --param-primary: #a855f7;
            --param-primary-hover: #9333ea;
            --param-light: #e9d5ff;
            --param-lighter: #faf5ff;
            --param-gradient: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            padding: 20px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-body {
            padding: 20px;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .flow-arrow {
            font-size: 1.8rem;
            color: var(--primary-color);
            text-align: center;
            margin: 16px 0;
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        .table-container,
        .request-status {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .table-container::-webkit-scrollbar,
        .request-status::-webkit-scrollbar {
            width: 6px;
        }

        .table-container::-webkit-scrollbar-track,
        .request-status::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .table-container::-webkit-scrollbar-thumb,
        .request-status::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        .table-container::-webkit-scrollbar-thumb:hover,
        .request-status::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .request-status {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 10px 12px;
            border: 1px solid var(--border-color);
        }

        .btn {
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.8rem;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #047857;
            color: white;
        }

        .btn-outline-secondary {
            background-color: transparent;
            color: var(--secondary-color);
            border: 1px solid var(--border-color);
        }

        .btn-outline-secondary:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .btn-group {
            display: inline-flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 8px;
            float: right;
            width: auto;
        }

        .btn-group+* {
            clear: both;
        }

        .btn-group .btn {
            padding: 4px 8px;
            font-size: 0.75rem;
            border-radius: 4px;
            gap: 3px;
        }

        .btn-group-custom {
            display: flex;
            gap: 6px;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .status-item {
            padding: 8px 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
        }

        .status-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--primary-color);
            opacity: 0.6;
        }

        .status-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid var(--success-color);
        }

        .status-success::before {
            background: var(--success-color);
        }

        .status-error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid var(--danger-color);
        }

        .status-error::before {
            background: var(--danger-color);
        }

        .result {
            word-wrap: break-word;
            font-size: 0.75rem;
            padding: 6px 8px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border-radius: 4px;
            margin-top: 6px;
            white-space: pre-wrap;
            border: 1px solid rgba(0, 0, 0, 0.08);
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            line-height: 1.4;
            cursor: pointer;
            font-weight: 400;
            letter-spacing: 0.005em;
            max-height: 120px;
            overflow-y: auto;
        }

        .result.success {
            color: var(--success-color);
            border-left: 3px solid var(--success-color);
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            box-shadow: 0 1px 4px rgba(34, 197, 94, 0.15);
        }

        .result.error {
            color: var(--danger-color);
            border-left: 3px solid var(--danger-color);
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            box-shadow: 0 1px 4px rgba(239, 68, 68, 0.15);
        }

        .preview-box {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
            padding: 16px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.875rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .step-icon {
            font-size: 0.85rem;
            margin-right: 5px;
            padding: 2px 5px;
            border-radius: 3px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(37, 99, 235, 0.15) 100%);
            display: inline-block;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .form-control {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px 12px;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }

        .form-text {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 3px;
        }

        .advanced-settings {
            display: none;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border-color);
            margin-top: 16px;
        }

        .advanced-settings.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress {
            height: 4px;
            border-radius: 3px;
            background: rgba(100, 116, 139, 0.15);
            overflow: hidden;
            margin: 6px 0;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, #3b82f6 100%);
            transition: width 0.3s ease;
            box-shadow: 0 0 4px rgba(59, 130, 246, 0.3);
        }

        .progress-info {
            font-size: 0.6rem;
            color: var(--text-secondary);
            margin-top: 3px;
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 500;
            letter-spacing: 0.001em;
        }

        .status-compact {
            font-size: 0.55rem;
            color: var(--text-muted);
            margin-top: 2px;
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            letter-spacing: 0.001em;
        }

        /* æ”¹å–„æ»¾å‹•æ¢æ¨£å¼ */
        .result::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        .result::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 2px;
        }

        .result::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }

        .result::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Excelé¢¨æ ¼è¡¨æ ¼ */
        .excel-table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            box-shadow: var(--shadow);
            font-family: 'Segoe UI', sans-serif;
            border-radius: 6px;
            overflow: hidden;
        }

        .excel-table th {
            background: var(--primary-color);
            border: none;
            padding: 12px 10px;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            color: white;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .excel-table td {
            border: 1px solid #e2e8f0;
            padding: 2px;
            min-width: 120px;
            position: relative;
            transition: all 0.2s ease;
        }

        .excel-table input {
            border: none;
            outline: none;
            width: 100%;
            padding: 8px 6px;
            background: transparent;
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.2s ease;
            border-radius: 4px;
            color: #1e293b;
        }

        .excel-table input:focus {
            background: #dbeafe;
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }

        .excel-table input:hover {
            background: rgba(248, 250, 252, 0.8);
        }

        .excel-table tr:nth-child(even) {
            background-color: rgba(248, 250, 252, 0.5);
        }

        .excel-table tr:hover {
            background: #f0f9ff;
        }

        .excel-table .selected {
            background: #dbeafe;
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }

        .excel-table .selected input {
            background: #dbeafe;
        }

        .excel-table .row-number {
            background: #e2e8f0;
            color: #64748b;
            font-weight: 600;
            text-align: center;
            width: 40px;
            min-width: 40px;
            padding: 8px 4px;
            border-right: 2px solid #cbd5e1;
            font-size: 0.8rem;
        }

        .excel-table .matched-row {
            background: #dcfce7 !important;
            animation: highlightRow 2s ease-in-out;
        }

        .excel-table .matched-row input {
            background: #dcfce7;
            font-weight: 600;
        }

        .excel-table .duplicate-row {
            background: #fef3c7 !important;
            animation: highlightDuplicate 1s ease-in-out;
        }

        .excel-table .duplicate-row input {
            background: #fef3c7;
            font-weight: 600;
        }

        @keyframes highlightRow {
            0% {
                background: #dcfce7;
            }

            50% {
                background: #bbf7d0;
            }

            100% {
                background: #dcfce7;
            }
        }

        @keyframes highlightDuplicate {
            0% {
                background: #fef3c7;
            }

            50% {
                background: #fed7aa;
            }

            100% {
                background: #fef3c7;
            }
        }

        /* é›™é‡å¾ªç’°ç¤ºæ„åœ–æ¨£å¼ */
        .loop-diagram {
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .loop-diagram:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        .loop-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .loop-outer,
        .loop-inner,
        .loop-result {
            background: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .loop-outer {
            border: 2px solid var(--main-primary);
            background: var(--main-gradient);
        }

        .loop-inner {
            border: 2px solid var(--param-primary);
            background: var(--param-gradient);
        }

        .loop-result {
            border: 2px solid var(--success-color);
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        }

        .loop-outer:hover,
        .loop-inner:hover,
        .loop-result:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        .loop-label {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 6px;
            text-align: center;
            color: var(--text-primary);
        }

        .loop-content {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .loop-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.7rem;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .loop-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.02);
        }

        .result-item {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: 500;
        }

        /* ç®­é ­å‹•ç•«æ¨£å¼ */
        .main-arrow,
        .param-arrow,
        .result-arrow {
            opacity: 0;
            transform: translateX(-3px);
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .loop-item.active .main-arrow,
        .loop-item.active .param-arrow,
        .loop-item.active .result-arrow {
            opacity: 1;
            transform: translateX(0);
            animation: arrowBounce 1s ease-in-out infinite;
        }

        .loop-item.active {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .loop-item.active.result-item {
            background: rgba(34, 197, 94, 0.2);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        .item-text {
            flex: 1;
        }

        .loop-status {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 12px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: inline-block;
        }

        .status-text {
            font-weight: 500;
        }

        #loop-status {
            color: var(--primary-color);
            font-weight: 600;
        }

        @keyframes arrowBounce {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(2px);
            }
        }



        /* è¡¨æ ¼è¡Œé«˜äº®æ¨£å¼ */
        .table-row-active {
            background-color: rgba(37, 99, 235, 0.1) !important;
            border-left: 4px solid var(--primary-color) !important;
        }

        .table-row-active td {
            background-color: rgba(37, 99, 235, 0.08) !important;
        }

        /* ä¸»é …è¡¨æ ¼è¡Œé«˜äº®æ¨£å¼ */
        .main-table-row-active {
            background-color: rgba(59, 130, 246, 0.1) !important;
            border-left: 4px solid var(--main-primary) !important;
        }

        .main-table-row-active td {
            background-color: rgba(59, 130, 246, 0.08) !important;
        }

        /* åƒæ•¸çµ„è¡¨æ ¼è¡Œé«˜äº®æ¨£å¼ */
        .param-table-row-active {
            background-color: rgba(236, 72, 153, 0.1) !important;
            border-left: 4px solid var(--param-primary) !important;
        }

        .param-table-row-active td {
            background-color: rgba(236, 72, 153, 0.08) !important;
        }

        .loop-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--primary-color);
            font-size: 1rem;
            font-weight: 600;
        }

        .loop-connector span {
            font-size: 1.4rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        .loop-formula {
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 16px;
            display: inline-block;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
        }

        .formula-text {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .formula-text::before {
            content: "ğŸ§®";
            font-size: 1rem;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .loop-container {
                flex-direction: column;
                gap: 16px;
            }

            .loop-connector {
                transform: rotate(90deg);
            }

            .loop-outer,
            .loop-inner,
            .loop-result {
                min-width: 200px;
            }
        }

        /* é è¦½éƒ¨åˆ†çš„å¾ªç’°çµæ§‹æ¨£å¼ */
        .preview-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .preview-header h6 {
            font-size: 0.9rem;
            margin-bottom: 6px;
        }

        .loop-summary {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 6px;
        }

        .loop-summary .badge {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .preview-content {
            margin-top: 12px;
        }

        .loop-outer-item {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.1);
        }

        .loop-header {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .loop-header span {
            font-size: 1rem;
        }

        .loop-inner-container {
            padding-left: 16px;
            border-left: 2px solid rgba(37, 99, 235, 0.3);
            margin-left: 6px;
        }

        .loop-inner-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 4px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .loop-inner-item span {
            font-size: 0.7rem;
            margin-right: 2px;
        }

        .request-url {
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            font-size: 0.6rem;
            color: var(--info-color);
            background: rgba(8, 145, 178, 0.1);
            padding: 4px 6px;
            border-radius: 3px;
            margin-left: 10px;
            display: inline-block;
            margin-top: 3px;
            font-weight: 400;
            letter-spacing: 0.005em;
            line-height: 1.2;
        }

        .request-body {
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            font-size: 0.6rem;
            color: var(--secondary-color);
            background: rgba(100, 116, 139, 0.1);
            padding: 4px 6px;
            border-radius: 3px;
            margin-left: 10px;
            display: inline-block;
            margin-top: 3px;
            font-weight: 400;
            letter-spacing: 0.005em;
            line-height: 1.2;
        }

        .request-info {
            margin-bottom: 6px;
        }

        .request-title {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 3px;
            font-size: 0.7rem;
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            letter-spacing: 0.003em;
        }

        .request-title span {
            font-size: 0.75rem;
        }

        .loop-badge {
            display: flex;
            gap: 3px;
            margin-left: auto;
        }

        .outer-loop,
        .inner-loop {
            font-size: 0.45rem;
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: 500;
        }

        .outer-loop {
            background: var(--main-primary);
            color: white;
        }

        .inner-loop {
            background: var(--param-primary);
            color: white;
        }

        .loop-inner-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(2px);
        }

        .request-details {
            font-size: 0.6rem;
            color: var(--text-secondary);
            margin-left: 15px;
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.2;
            font-weight: 400;
            letter-spacing: 0.001em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .request-details:hover {
            color: var(--text-primary);
            background: rgba(248, 250, 252, 0.5);
            border-radius: 3px;
            padding: 2px 4px;
            white-space: normal;
            word-wrap: break-word;
            overflow: visible;
        }

        .expandable-text {
            font-size: 0.55rem;
            color: var(--text-secondary);
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            margin-left: 15px;
            margin-top: 2px;
            padding: 2px 4px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 2px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 400;
            letter-spacing: 0.001em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .expandable-text:hover {
            color: var(--text-primary);
            background: rgba(248, 250, 252, 0.9);
            white-space: normal;
            word-wrap: break-word;
            overflow: visible;
            max-height: 150px;
            overflow-y: auto;
        }


        .badge {
            font-size: 0.6rem;
            padding: 3px 6px;
            border-radius: 3px;
        }

        .alert {
            padding: 8px 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-size: 0.65rem;
        }

        .alert strong {
            font-size: 0.65rem;
        }

        /* çµæœå€åŸŸæ¨™é¡Œå­—é«”å„ªåŒ– */
        .text-primary.mb-2 {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            font-size: 0.8rem;
            letter-spacing: 0.005em;
        }

        /* ç‹€æ…‹é …ç›®æ•´é«”å­—é«”å„ªåŒ– */
        .status-item {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* ä¸»é …è¡¨æ ¼ç‰¹å®šæ¨£å¼ */
        .main-excel-table th {
            background: var(--main-primary) !important;
            color: white !important;
        }

        .main-excel-table input:focus {
            background: var(--main-light) !important;
            box-shadow: inset 0 0 0 2px var(--main-primary) !important;
        }

        .main-excel-table tr:hover {
            background: var(--main-lighter) !important;
        }

        .main-excel-table .selected {
            background: var(--main-light) !important;
            box-shadow: inset 0 0 0 2px var(--main-primary) !important;
        }

        .main-excel-table .selected input {
            background: var(--main-light) !important;
        }

        /* åƒæ•¸çµ„è¡¨æ ¼ç‰¹å®šæ¨£å¼ */
        .param-excel-table th {
            background: var(--param-primary) !important;
            color: white !important;
        }

        .param-excel-table input:focus {
            background: var(--param-light) !important;
            box-shadow: inset 0 0 0 2px var(--param-primary) !important;
        }

        .param-excel-table tr:hover {
            background: var(--param-lighter) !important;
        }

        .param-excel-table .selected {
            background: var(--param-light) !important;
            box-shadow: inset 0 0 0 2px var(--param-primary) !important;
        }

        .param-excel-table .selected input {
            background: var(--param-light) !important;
        }

        /* ä¸»é …è¡¨æ ¼æŒ‰éˆ•çµ„æ¨£å¼ */
        .main-btn-group .btn-primary {
            background: var(--main-primary) !important;
            border-color: var(--main-primary) !important;
        }

        .main-btn-group .btn-primary:hover {
            background: var(--main-primary-hover) !important;
            border-color: var(--main-primary-hover) !important;
        }

        /* åƒæ•¸çµ„è¡¨æ ¼æŒ‰éˆ•çµ„æ¨£å¼ */
        .param-btn-group .btn-primary {
            background: var(--param-primary) !important;
            border-color: var(--param-primary) !important;
        }

        .param-btn-group .btn-primary:hover {
            background: var(--param-primary-hover) !important;
            border-color: var(--param-primary-hover) !important;
        }

        /* ä¸»é …è¡¨æ ¼å¡ç‰‡æ¨™é¡Œæ¨£å¼ */
        .main-card-title {
            color: var(--main-primary) !important;
        }

        .main-card-title .step-icon {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.15) 100%) !important;
        }

        /* åƒæ•¸çµ„è¡¨æ ¼å¡ç‰‡æ¨™é¡Œæ¨£å¼ */
        .param-card-title {
            color: var(--param-primary) !important;
        }

        .param-card-title .step-icon {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(236, 72, 153, 0.15) 100%) !important;
        }

        /* ä¸»é …è¡¨æ ¼æç¤ºæ¡†æ¨£å¼ */
        .main-alert {
            background: var(--main-lighter) !important;
            border: 1px solid var(--main-light) !important;
            color: var(--main-primary) !important;
        }

        /* åƒæ•¸çµ„è¡¨æ ¼æç¤ºæ¡†æ¨£å¼ */
        .param-alert {
            background: var(--param-lighter) !important;
            border: 1px solid var(--param-light) !important;
            color: var(--param-primary) !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-6 fw-bold text-primary mb-2"
                style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                ğŸš€ æ‰¹é‡è‡ªè¨‚åƒæ•¸çš„HTTPè«‹æ±‚å™¨
            </h1>
            <p class="text-muted mb-0" style="font-size: 0.9rem; letter-spacing: 0.5px;">
                ğŸ”„ é›™å¾ªç’°_ä¸»é …åŠTSVæ ¼å¼åƒæ•¸ | ğŸ“Š æ”¯æ´ExcelåŒ¯å…¥åŒ¯å‡º
            </p>
        </div>

        <!-- é…ç½®ç®¡ç†å·¥å…·åˆ— -->
        <div class="card mb-4"
            style="background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%); border: none; box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);">
            <div class="card-body py-2">
                <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                    <span style="color: white; font-weight: 500; font-size: 0.85rem;"><i class="bi bi-gear-fill"></i>
                        é…ç½®ç®¡ç†</span>
                    <div class="d-flex gap-2 flex-wrap">
                        <input type="file" id="import-config" accept=".json" style="display: none;">
                        <button class="btn btn-light btn-sm" id="import-config-btn" title="å¾ JSON æª”æ¡ˆåŒ¯å…¥å…ˆå‰ä¿å­˜çš„é…ç½®"><i
                                class="bi bi-folder2-open"></i>
                            åŒ¯å…¥é…ç½®</button>
                        <button class="btn btn-light btn-sm" id="export-config" title="å°‡ç•¶å‰é…ç½®åŒ¯å‡ºç‚º JSON æª”æ¡ˆ"><i
                                class="bi bi-floppy"></i>
                            åŒ¯å‡ºé…ç½®</button>
                        <button class="btn btn-outline-light btn-sm" id="clear-storage" title="æ¸…ç©ºæ‰€æœ‰è¡¨æ ¼å’Œè¨­å®š"><i
                                class="bi bi-trash"></i>
                            æ¸…ç©º</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é›™é‡å¾ªç’°ç¤ºæ„åœ– -->
        <div class="card bg-light mb-4">
            <div class="card-body text-center">
                <h6 class="card-title text-primary mb-3">
                    <i class="bi bi-diagram-3-fill"></i> é›™é‡å¾ªç’°ç¤ºæ„åœ–
                    <small class="text-muted">(é»æ“Šæš«åœå‹•ç•«)</small>
                </h6>
                <div class="loop-diagram" style="cursor: pointer;" title="é»æ“Šæš«åœå‹•ç•«">
                    <div class="loop-container">
                        <div class="loop-outer">
                            <div class="loop-label">ğŸ”„ å¤–å±¤å¾ªç’° (ä¸»é …è¡¨æ ¼)</div>
                            <div class="loop-content">
                                <div class="loop-item" data-main-index="0">
                                    <span class="main-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ“‹ ä¸»é …è¡Œ1</span>
                                </div>
                                <div class="loop-item" data-main-index="1">
                                    <span class="main-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ“‹ ä¸»é …è¡Œ2</span>
                                </div>
                                <div class="loop-item" data-main-index="2">
                                    <span class="main-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ“‹ ä¸»é …è¡Œ3</span>
                                </div>
                            </div>
                        </div>
                        <div class="loop-connector">
                            <span>â¡ï¸</span>
                            <span>âœ–ï¸</span>
                        </div>
                        <div class="loop-inner">
                            <div class="loop-label">ğŸ” å…§å±¤å¾ªç’° (åƒæ•¸çµ„è¡¨æ ¼)</div>
                            <div class="loop-content">
                                <div class="loop-item" data-param-index="0">
                                    <span class="param-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ›ï¸ åƒæ•¸çµ„1</span>
                                </div>
                                <div class="loop-item" data-param-index="1">
                                    <span class="param-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ›ï¸ åƒæ•¸çµ„2</span>
                                </div>
                                <div class="loop-item" data-param-index="2">
                                    <span class="param-arrow">ğŸ‘‰</span>
                                    <span class="item-text">ğŸ›ï¸ åƒæ•¸çµ„3</span>
                                </div>
                            </div>
                        </div>
                        <div class="loop-connector">
                            <span>â¡ï¸</span>
                            <span>ğŸŸ°</span>
                        </div>
                        <div class="loop-result">
                            <div class="loop-label">ğŸš€ ç”Ÿæˆè«‹æ±‚</div>
                            <div class="loop-content">
                                <div class="loop-item result-item" data-request-index="0">
                                    <span class="result-arrow">âœ¨</span>
                                    <span class="item-text request-text">ğŸ“¡ è«‹æ±‚1</span>
                                </div>
                                <div class="loop-item result-item" data-request-index="1">
                                    <span class="result-arrow">âœ¨</span>
                                    <span class="item-text request-text">ğŸ“¡ è«‹æ±‚2</span>
                                </div>
                                <div class="loop-item result-item" data-request-index="2">
                                    <span class="result-arrow">âœ¨</span>
                                    <span class="item-text request-text">ğŸ“¡ è«‹æ±‚3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="loop-formula mt-3">
                        <span class="formula-text">ğŸ§® ç¸½è«‹æ±‚æ•¸ = ä¸»é …è¡Œæ•¸ Ã— åƒæ•¸çµ„è¡Œæ•¸</span>
                    </div>
                    <div class="loop-status mt-2">
                        <span class="status-text">ğŸ¬ ç•¶å‰ç‹€æ…‹ï¼š<span id="loop-status">ä¸»é …è¡Œ1 Ã— åƒæ•¸çµ„1 = è«‹æ±‚1</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 1ï¼šè¨­ç½®ä¸»é …è¡¨æ ¼ -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title main-card-title"><span class="step-icon">1ï¸âƒ£</span>è¨­ç½®ä¸»é …è¡¨æ ¼ (å¤–å±¤å¾ªç’°ï¼šä¸»è¦é …ç›®)</h5>
                <div class="mb-3">
                    <div class="alert alert-info main-alert d-flex align-items-center">
                        <span class="me-2">â„¹ï¸</span>
                        <div>
                            <strong>å¤–å±¤å¾ªç’°èªªæ˜ï¼š</strong>æ¯ä¸€è¡Œä¸»é …éƒ½æœƒè§¸ç™¼ä¸€è¼ªå®Œæ•´çš„å…§å±¤å¾ªç’°ï¼Œèˆ‡æ‰€æœ‰åƒæ•¸çµ„é€²è¡Œçµ„åˆ
                        </div>
                    </div>
                </div>
                <div class="btn-group main-btn-group mb-2">
                    <button class="btn btn-primary" id="add-main-row" title="æ–°å¢ä¸€è¡Œ">â• æ–°å¢è¡Œ</button>
                    <button class="btn btn-primary" id="add-main-column" title="æ–°å¢ä¸€åˆ—">ğŸ“‹ æ–°å¢åˆ—</button>
                    <button class="btn btn-secondary" id="del-main-row" title="åˆªé™¤æœ€å¾Œä¸€è¡Œ">â– åˆªé™¤è¡Œ</button>
                    <button class="btn btn-secondary" id="del-main-column" title="åˆªé™¤æœ€å¾Œä¸€åˆ—">ğŸ—‘ï¸ åˆªé™¤åˆ—</button>
                    <button class="btn btn-secondary" id="clear-main-table" title="æ¸…ç©ºè¡¨æ ¼">ğŸ§¹ æ¸…ç©ºè¡¨æ ¼</button>
                    <button class="btn btn-primary" id="export-main-table" title="åŒ¯å‡ºç‚ºTSVæ ¼å¼ï¼Œå¯ç”¨Excelé–‹å•Ÿ">ğŸ“¤ åŒ¯å‡ºTSV</button>
                    <input type="file" id="import-main-table" accept=".txt,.tsv,.csv,.xlsx,.xls" style="display:none;">
                    <button class="btn btn-primary" id="import-main-table-btn" title="æ”¯æ´TSVã€CSVã€Excelæ ¼å¼">ğŸ“¥
                        åŒ¯å…¥TSV</button>
                </div>
                <div class="table-container">
                    <table class="excel-table main-excel-table" id="main-excel-table">
                        <thead>
                            <tr id="main-excel-header"></tr>
                        </thead>
                        <tbody id="main-excel-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 2ï¼šè¨­ç½®åƒæ•¸çµ„è¡¨æ ¼ -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title param-card-title"><span class="step-icon">2ï¸âƒ£</span>è¨­ç½®åƒæ•¸çµ„è¡¨æ ¼ (å…§å±¤å¾ªç’°ï¼šåƒæ•¸çµ„åˆ)</h5>
                <div class="mb-3">
                    <div class="alert alert-warning param-alert d-flex align-items-center">
                        <span class="me-2">âš ï¸</span>
                        <div>
                            <strong>å…§å±¤å¾ªç’°èªªæ˜ï¼š</strong>æ¯ä¸€è¡Œåƒæ•¸çµ„éƒ½æœƒèˆ‡æ¯ä¸€è¡Œä¸»é …é€²è¡Œçµ„åˆï¼Œç”Ÿæˆä¸€å€‹ç¨ç«‹çš„è«‹æ±‚
                        </div>
                    </div>
                </div>
                <div class="btn-group param-btn-group mb-2">
                    <button class="btn btn-primary" id="add-row" title="æ–°å¢ä¸€è¡Œ">â• æ–°å¢è¡Œ</button>
                    <button class="btn btn-primary" id="add-column" title="æ–°å¢ä¸€åˆ—">ğŸ“‹ æ–°å¢åˆ—</button>
                    <button class="btn btn-secondary" id="del-row" title="åˆªé™¤æœ€å¾Œä¸€è¡Œ">â– åˆªé™¤è¡Œ</button>
                    <button class="btn btn-secondary" id="del-column" title="åˆªé™¤æœ€å¾Œä¸€åˆ—">ğŸ—‘ï¸ åˆªé™¤åˆ—</button>
                    <button class="btn btn-secondary" id="clear-table" title="æ¸…ç©ºè¡¨æ ¼">ğŸ§¹ æ¸…ç©ºè¡¨æ ¼</button>
                    <button class="btn btn-primary" id="export-table" title="åŒ¯å‡ºç‚ºTSVæ ¼å¼ï¼Œå¯ç”¨Excelé–‹å•Ÿ">ğŸ“¤ åŒ¯å‡ºTSV</button>
                    <input type="file" id="import-table" accept=".txt,.tsv,.csv,.xlsx,.xls" style="display:none;">
                    <button class="btn btn-primary" id="import-table-btn" title="æ”¯æ´TSVã€CSVã€Excelæ ¼å¼">ğŸ“¥ åŒ¯å…¥TSV</button>
                </div>
                <div class="table-container">
                    <table class="excel-table param-excel-table" id="excel-table">
                        <thead>
                            <tr id="excel-header"></tr>
                        </thead>
                        <tbody id="excel-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="flow-arrow">â¬‡ï¸</div>

        <!-- æ­¥é©Ÿ 3ï¼šè¨­ç½®è«‹æ±‚æ¨¡æ¿ & ç™¼é€è«‹æ±‚ä¸¦æŸ¥çœ‹çµæœ -->
        <div class="row">
            <!-- å·¦å´ï¼šè¨­ç½®è«‹æ±‚æ¨¡æ¿ -->
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><span class="step-icon">3ï¸âƒ£</span>è¨­ç½®è«‹æ±‚æ¨¡æ¿</h5>

                        <!-- ä½”ä½ç¬¦èªªæ˜å€å¡Š -->
                        <div class="placeholder-guide mb-3"
                            style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; font-size: 0.85rem;">
                            <div style="font-weight: 600; color: #0369a1; margin-bottom: 8px;">ğŸ“Œ ä½”ä½ç¬¦å°ç…§èªªæ˜</div>
                            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <div
                                        style="background: var(--main-light); padding: 8px 10px; border-radius: 6px; border-left: 3px solid var(--main-primary);">
                                        <code style="color: var(--main-primary); font-weight: 600;">{MainItem1}</code>,
                                        <code
                                            style="color: var(--main-primary); font-weight: 600;">{MainItem2}</code>...
                                        <div style="color: #475569; font-size: 0.75rem; margin-top: 4px;">ğŸ‘† å°æ‡‰
                                            <strong>æ­¥é©Ÿ1 ä¸»é …è¡¨æ ¼</strong> çš„ç¬¬1åˆ—ã€ç¬¬2åˆ—...
                                        </div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 200px;">
                                    <div
                                        style="background: var(--param-light); padding: 8px 10px; border-radius: 6px; border-left: 3px solid var(--param-primary);">
                                        <code
                                            style="color: var(--param-primary); font-weight: 600;">{Parameter1}</code>,
                                        <code
                                            style="color: var(--param-primary); font-weight: 600;">{Parameter2}</code>...
                                        <div style="color: #475569; font-size: 0.75rem; margin-top: 4px;">ğŸ‘† å°æ‡‰
                                            <strong>æ­¥é©Ÿ2 åƒæ•¸çµ„è¡¨æ ¼</strong> çš„ç¬¬1åˆ—ã€ç¬¬2åˆ—...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="request-method" class="form-label">è«‹æ±‚æ–¹æ³•</label>
                            <select class="form-select" id="request-method">
                                <option value="GET">GET</option>
                                <option value="POST">POST (JSON)</option>
                            </select>
                            <small class="form-text text-muted">é¸æ“‡ HTTP è«‹æ±‚é¡å‹</small>
                        </div>
                        <div class="mb-3">
                            <label for="url-template" class="form-label">URL æ¨¡æ¿</label>
                            <input type="text" class="form-control" id="url-template"
                                placeholder="ä¾‹å¦‚: https://api.example.com/?id={MainItem1}&key={Parameter1}">
                            <small class="form-text text-muted">åœ¨ URL ä¸­ä½¿ç”¨ä¸Šæ–¹çš„ä½”ä½ç¬¦ï¼Œç³»çµ±æœƒè‡ªå‹•æ›¿æ›ç‚ºè¡¨æ ¼ä¸­çš„å¯¦éš›æ•¸æ“š</small>
                        </div>
                        <div id="post-config" hidden>
                            <div class="mb-3">
                                <label for="post-body-template" class="form-label">POST è«‹æ±‚é«”æ¨¡æ¿</label>
                                <textarea class="form-control" id="post-body-template" rows="2"
                                    placeholder='ä¾‹å¦‚: {"id": "{MainItem1}", "key": "{Parameter1}"}'></textarea>
                                <small class="form-text text-muted">è¼¸å…¥æœ‰æ•ˆçš„ JSON æ ¼å¼ï¼Œä½¿ç”¨ä¸Šæ–¹çš„ä½”ä½ç¬¦æ›¿æ›å‹•æ…‹æ•¸æ“š</small>
                            </div>
                        </div>
                        <button class="btn btn-outline-secondary mt-2" id="toggle-advanced"><i class="bi bi-gear"></i>
                            é€²éšè¨­ç½®</button>
                        <div class="advanced-settings" id="advanced-settings">
                            <div class="mt-3">
                                <label for="request-delay" class="form-label">æ¯æ¬¡è«‹æ±‚é–“éš” (æ¯«ç§’)</label>
                                <input type="number" class="form-control" id="request-delay" min="0" value="3000"
                                    step="100">
                                <small class="form-text text-muted">è¨­ç½®ç‚º 0 è¡¨ç¤ºç„¡é–“éš”ï¼Œå»ºè­° 500ms æˆ–ä»¥ä¸Šä»¥é¿å…éè¼‰</small>
                            </div>
                            <div class="mt-3">
                                <label class="form-label">å•Ÿç”¨ HTTP Authorization</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable-auth">
                                    <label class="form-check-label" for="enable-auth">å•Ÿç”¨</label>
                                </div>
                                <small class="form-text text-muted">å•Ÿç”¨å¾Œå¯è¨­ç½®èªè­‰é ­</small>
                            </div>
                            <div id="auth-config" hidden>
                                <div class="mt-3">
                                    <label for="auth-type" class="form-label">Authorization é¡å‹</label>
                                    <select class="form-select" id="auth-type">
                                        <option value="Basic">Basic</option>
                                        <option value="Bearer">Bearer</option>
                                    </select>
                                    <small class="form-text text-muted">Basic ä½¿ç”¨ç”¨æˆ¶åå’Œå¯†ç¢¼ï¼ŒBearer ä½¿ç”¨ Token</small>
                                </div>
                                <div id="basic-auth-fields" hidden>
                                    <div class="mt-3">
                                        <label for="auth-username" class="form-label">ç”¨æˆ¶å</label>
                                        <input type="text" class="form-control" id="auth-username" placeholder="è¼¸å…¥ç”¨æˆ¶å">
                                        <small class="form-text text-muted">ç”¨æ–¼ Basic èªè­‰</small>
                                    </div>
                                    <div class="mt-3">
                                        <label for="auth-password" class="form-label">å¯†ç¢¼</label>
                                        <input type="password" class="form-control" id="auth-password"
                                            placeholder="è¼¸å…¥å¯†ç¢¼">
                                        <small class="form-text text-muted">ç”¨æ–¼ Basic èªè­‰</small>
                                    </div>
                                </div>
                                <div id="bearer-auth-field" hidden>
                                    <div class="mt-3">
                                        <label for="auth-token" class="form-label">Bearer Token</label>
                                        <input type="text" class="form-control" id="auth-token"
                                            placeholder="è¼¸å…¥ API Token">
                                        <small class="form-text text-muted">è¼¸å…¥å®Œæ•´çš„ Bearer Token</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šç™¼é€è«‹æ±‚ä¸¦æŸ¥çœ‹çµæœ -->
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><span class="step-icon">4ï¸âƒ£</span>ç™¼é€è«‹æ±‚ä¸¦æŸ¥çœ‹çµæœ</h5>

                        <div class="d-flex gap-2 mb-3">
                            <button class="btn btn-success" id="send-request" title="ç™¼é€æ‰€æœ‰ç”Ÿæˆçš„è«‹æ±‚"><i
                                    class="bi bi-rocket-takeoff"></i> é–‹å§‹ç™¼é€</button>
                            <button class="btn btn-outline-secondary btn-sm" id="copy-results" title="è¤‡è£½æ‰€æœ‰è«‹æ±‚çµæœ"><i
                                    class="bi bi-clipboard"></i></button>

                            <button class="btn btn-outline-danger btn-sm" id="clear-results" title="æ¸…ç©ºçµæœ"><i
                                    class="bi bi-trash"></i></button>
                            <button class="btn btn-outline-success btn-sm" id="scroll-indicator" title="è‡ªå‹•æ»¾å‹•é–‹å•Ÿä¸­ (é»æ“Šæš«åœ)">
                                <i class="bi bi-arrow-down-circle"></i>
                            </button>
                        </div>

                        <div>
                            <h6 class="text-primary mb-2"><i class="bi bi-bar-chart-fill"></i> åŸ·è¡Œé€²åº¦</h6>
                            <div class="progress mb-2" id="total-progress">
                                <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
                                    aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="request-status mt-3">
                            <h6 class="text-primary mb-2">ğŸ“‹ è«‹æ±‚çµæœ</h6>
                            <div id="status-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const elements = {
            statusContainer: document.getElementById('status-container'),
            totalProgress: document.getElementById('total-progress').querySelector('.progress-bar')
        };

        // ä¸»é …è¡¨æ ¼è³‡æ–™çµæ§‹
        let mainExcelData = [["", ""]]; // é è¨­1è¡Œ2åˆ—
        const mainExcelBody = document.getElementById('main-excel-body');
        const mainExcelHeader = document.getElementById('main-excel-header');
        let selectedMainCell = null; // ç•¶å‰é¸ä¸­çš„ä¸»é …è¡¨æ ¼å–®å…ƒæ ¼

        // åƒæ•¸çµ„è¡¨æ ¼è³‡æ–™çµæ§‹
        let paramExcelData = [["", ""]]; // é è¨­1è¡Œ2åˆ—
        const paramExcelBody = document.getElementById('excel-body');
        const paramExcelHeader = document.getElementById('excel-header');
        let selectedParamCell = null; // ç•¶å‰é¸ä¸­çš„åƒæ•¸è¡¨æ ¼å–®å…ƒæ ¼

        // ä¸»é …è¡¨æ ¼æ“ä½œ
        function renderMainExcelTable() {
            // æ¸²æŸ“è¡¨é ­
            mainExcelHeader.innerHTML = '<th class="row-number">#</th>' + mainExcelData[0].map((_, i) => `<th>ä¸»é …${i + 1}</th>`).join('');
            // æ¸²æŸ“è¡¨èº«
            mainExcelBody.innerHTML = mainExcelData.map((row, ri) =>
                `<tr data-main-row="${ri}"><td class="row-number">${ri + 1}</td>` +
                row.map((cell, ci) => `<td><input type="text" value="${cell}" data-row="${ri}" data-col="${ci}" class="form-control main-excel-input" placeholder="è¼¸å…¥ä¸»é …æ•¸æ“š"></td>`).join('') +
                '</tr>'
            ).join('');
            // ç¶å®šäº‹ä»¶
            document.querySelectorAll('.main-excel-input').forEach(input => {
                input.addEventListener('input', e => {
                    const r = +input.dataset.row, c = +input.dataset.col;
                    mainExcelData[r][c] = input.value;
                    saveConfig();
                });
                input.addEventListener('focus', () => {
                    selectMainCell(input);
                    input.select();
                });
            });
        }

        // é¸ä¸­ä¸»é …è¡¨æ ¼å–®å…ƒæ ¼
        function selectMainCell(input) {
            if (selectedMainCell) {
                selectedMainCell.classList.remove('selected');
            }
            selectedMainCell = input;
            input.classList.add('selected');
        }

        function addMainExcelRow() {
            mainExcelData.push(Array(mainExcelData[0].length).fill(""));
            renderMainExcelTable();
            saveConfig();
        }

        function addMainExcelCol() {
            mainExcelData.forEach(row => row.push(""));
            renderMainExcelTable();
            saveConfig();
        }

        function delMainExcelRow() {
            if (mainExcelData.length > 1) { mainExcelData.pop(); renderMainExcelTable(); saveConfig(); }
        }

        function delMainExcelCol() {
            if (mainExcelData[0].length > 1) { mainExcelData.forEach(row => row.pop()); renderMainExcelTable(); saveConfig(); }
        }

        function clearMainExcelTable() {
            mainExcelData = [["", ""]];
            renderMainExcelTable();
            saveConfig();
        }

        function exportMainExcelTable() {
            const tsv = mainExcelData.map(row => row.join('\t')).join('\n');
            const blob = new Blob([tsv], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `main-items-${new Date().toISOString().split('T')[0]}.tsv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importMainExcelTableFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                const lines = ev.target.result.split(/\r?\n/).filter(Boolean);
                mainExcelData = lines.map(line => line.split(/\t|,/)); // ä½¿ç”¨åˆ¶è¡¨ç¬¦å’Œé€—è™Ÿä½œç‚ºåˆ†éš”ç¬¦
                if (mainExcelData.length === 0) mainExcelData = [["", ""]];
                renderMainExcelTable();
                saveConfig();
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // åƒæ•¸çµ„è¡¨æ ¼æ“ä½œ
        function renderParamExcelTable() {
            // æ¸²æŸ“è¡¨é ­
            paramExcelHeader.innerHTML = '<th class="row-number">#</th>' + paramExcelData[0].map((_, i) => `<th>åƒæ•¸${i + 1}</th>`).join('');
            // æ¸²æŸ“è¡¨èº«
            paramExcelBody.innerHTML = paramExcelData.map((row, ri) =>
                `<tr data-param-row="${ri}"><td class="row-number">${ri + 1}</td>` +
                row.map((cell, ci) => `<td><input type="text" value="${cell}" data-row="${ri}" data-col="${ci}" class="form-control param-excel-input" placeholder="è¼¸å…¥åƒæ•¸æ•¸æ“š"></td>`).join('') +
                '</tr>'
            ).join('');
            // ç¶å®šäº‹ä»¶
            document.querySelectorAll('.param-excel-input').forEach(input => {
                input.addEventListener('input', e => {
                    const r = +input.dataset.row, c = +input.dataset.col;
                    paramExcelData[r][c] = input.value;
                    saveConfig();
                });
                input.addEventListener('focus', () => {
                    selectParamCell(input);
                    input.select();
                });
            });
        }

        // é¸ä¸­åƒæ•¸è¡¨æ ¼å–®å…ƒæ ¼
        function selectParamCell(input) {
            if (selectedParamCell) {
                selectedParamCell.classList.remove('selected');
            }
            selectedParamCell = input;
            input.classList.add('selected');
        }

        function addParamExcelRow() {
            paramExcelData.push(Array(paramExcelData[0].length).fill(""));
            renderParamExcelTable();
            saveConfig();
        }

        function addParamExcelCol() {
            paramExcelData.forEach(row => row.push(""));
            renderParamExcelTable();
            saveConfig();
        }

        function delParamExcelRow() {
            if (paramExcelData.length > 1) { paramExcelData.pop(); renderParamExcelTable(); saveConfig(); }
        }

        function delParamExcelCol() {
            if (paramExcelData[0].length > 1) { paramExcelData.forEach(row => row.pop()); renderParamExcelTable(); saveConfig(); }
        }

        function clearParamExcelTable() {
            paramExcelData = [["", ""]];
            renderParamExcelTable();
            saveConfig();
        }

        function exportParamExcelTable() {
            const tsv = paramExcelData.map(row => row.join('\t')).join('\n');
            const blob = new Blob([tsv], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `params-${new Date().toISOString().split('T')[0]}.tsv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importParamExcelTableFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                const lines = ev.target.result.split(/\r?\n/).filter(Boolean);
                paramExcelData = lines.map(line => line.split(/\t|,/)); // ä½¿ç”¨åˆ¶è¡¨ç¬¦å’Œé€—è™Ÿä½œç‚ºåˆ†éš”ç¬¦
                if (paramExcelData.length === 0) paramExcelData = [["", ""]];
                renderParamExcelTable();
                saveConfig();
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // é…ç½®ç®¡ç†
        function saveConfig() {
            const config = {
                mainExcelData: mainExcelData,
                paramExcelData: paramExcelData,
                method: $('#request-method').value,
                urlTemplate: $('#url-template').value,
                postBody: $('#post-body-template').value,
                delay: $('#request-delay').value,
                enableAuth: $('#enable-auth').checked,
                authType: $('#auth-type').value,
                authUsername: $('#auth-username').value,
                authPassword: $('#auth-password').value,
                authToken: $('#auth-token').value
            };
            localStorage.setItem('requestConfig', JSON.stringify(config));
            updateRequestPreview();
        }

        // æ›´æ–°è«‹æ±‚é è¦½çµ±è¨ˆ
        function updateRequestPreview() {
            const mainRows = mainExcelData.length;
            const paramRows = paramExcelData.length;
            const totalRequests = mainRows * paramRows;
            const previewElement = document.getElementById('request-preview-count');
            if (previewElement) {
                previewElement.innerHTML = `ä¸»é … <strong>${mainRows}</strong> è¡Œ Ã— åƒæ•¸çµ„ <strong>${paramRows}</strong> è¡Œ = <strong style="color: var(--success-color); font-size: 1.1em;">${totalRequests}</strong> å€‹è«‹æ±‚`;
            }
        }

        function loadConfig() {
            const config = JSON.parse(localStorage.getItem('requestConfig') || '{}');

            // è¼‰å…¥ä¸»é …è¡¨æ ¼æ•¸æ“š
            if (config.mainExcelData) {
                mainExcelData = config.mainExcelData;
            } else {
                mainExcelData = [["", ""]];
            }

            // è¼‰å…¥åƒæ•¸è¡¨æ ¼æ•¸æ“š
            if (config.paramExcelData) {
                paramExcelData = config.paramExcelData;
            } else if (config.excelData) {
                // å‘å¾Œå…¼å®¹ï¼šå¦‚æœæœ‰èˆŠçš„excelDataï¼Œå°‡å…¶ä½œç‚ºåƒæ•¸è¡¨æ ¼æ•¸æ“š
                paramExcelData = config.excelData;
            } else {
                paramExcelData = [["", ""]];
            }

            renderMainExcelTable();
            renderParamExcelTable();

            $('#request-method').value = config.method || 'GET';
            $('#url-template').value = config.urlTemplate || '';
            $('#post-body-template').value = config.postBody || '';
            $('#request-delay').value = config.delay || '3000';
            $('#enable-auth').checked = config.enableAuth || false;
            $('#auth-type').value = config.authType || 'Basic';
            $('#auth-username').value = config.authUsername || '';
            $('#auth-password').value = config.authPassword || '';
            $('#auth-token').value = config.authToken || '';
            $('#post-config').hidden = config.method !== 'POST';
            $('#auth-config').hidden = !config.enableAuth;
            $('#basic-auth-fields').hidden = !(config.enableAuth && config.authType === 'Basic');
            $('#bearer-auth-field').hidden = !(config.enableAuth && config.authType === 'Bearer');
            updateRequestPreview();
        }

        function clearConfig() {
            if (confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Ÿ')) {
                localStorage.clear();
                location.reload();
            }
        }

        function exportConfig() {
            const config = localStorage.getItem('requestConfig');
            const blob = new Blob([config], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `request-config-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importConfig(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                localStorage.setItem('requestConfig', e.target.result);
                loadConfig();
                elements.statusContainer.innerHTML = '<div class="alert alert-success">å·²åŒ¯å…¥</div>';
            };
            reader.readAsText(file);
            $('#import-config').value = '';
        }

        // è«‹æ±‚è™•ç†
        async function sendRequest(method, url, body) {
            const options = { method };
            if ($('#enable-auth').checked) {
                const authType = $('#auth-type').value;
                options.headers = options.headers || {};
                if (authType === 'Basic') {
                    const username = $('#auth-username').value.trim();
                    const password = $('#auth-password').value.trim();
                    if (!username || !password) throw new Error('Basic Auth éœ€è¦ç”¨æˆ¶åå’Œå¯†ç¢¼');
                    options.headers['Authorization'] = `Basic ${btoa(`${username}:${password}`)}`;
                } else if (authType === 'Bearer') {
                    const token = $('#auth-token').value.trim();
                    if (!token) throw new Error('Bearer Auth éœ€è¦ Token');
                    options.headers['Authorization'] = `Bearer ${token}`;
                }
            }
            if (method === 'POST' && body) {
                options.headers = options.headers || {};
                options.headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(body);
            }
            try {
                const response = await fetch(url, options);
                return { success: true, data: await response.text() };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function formatResult(text, success) {
            const max = 100;
            return text.length > max ? { short: `${text.slice(0, max)} ... (é»æ“Šå±•é–‹)`, full: text } : { short: text, full: text };
        }

        // è¡¨æ ¼ä½ç½®æŒ‡ç¤ºå‡½æ•¸
        function updateTableHighlight(mainRowIndex, paramRowIndex) {
            // æ¸…é™¤æ‰€æœ‰è¡Œé«˜äº®
            clearTableHighlight();

            // è¨­ç½®ä¸»é …è¡¨æ ¼è¡Œé«˜äº®
            const mainRow = document.querySelector(`[data-main-row="${mainRowIndex}"]`);
            if (mainRow) {
                mainRow.classList.add('main-table-row-active');
            }

            // è¨­ç½®åƒæ•¸çµ„è¡¨æ ¼è¡Œé«˜äº®
            const paramRow = document.querySelector(`[data-param-row="${paramRowIndex}"]`);
            if (paramRow) {
                paramRow.classList.add('param-table-row-active');
            }
        }

        function clearTableHighlight() {
            // æ¸…é™¤æ‰€æœ‰è¡Œé«˜äº®
            document.querySelectorAll('.main-table-row-active, .param-table-row-active').forEach(row => {
                row.classList.remove('main-table-row-active', 'param-table-row-active');
            });
        }

        // ä¸»é …è¡¨æ ¼äº‹ä»¶ç¶å®š
        $('#add-main-row').addEventListener('click', addMainExcelRow);
        $('#add-main-column').addEventListener('click', addMainExcelCol);
        $('#del-main-row').addEventListener('click', delMainExcelRow);
        $('#del-main-column').addEventListener('click', delMainExcelCol);
        $('#clear-main-table').addEventListener('click', clearMainExcelTable);
        $('#export-main-table').addEventListener('click', exportMainExcelTable);
        $('#import-main-table-btn').addEventListener('click', () => $('#import-main-table').click());
        $('#import-main-table').addEventListener('change', importMainExcelTableFile);

        // åƒæ•¸è¡¨æ ¼äº‹ä»¶ç¶å®š
        $('#add-row').addEventListener('click', addParamExcelRow);
        $('#add-column').addEventListener('click', addParamExcelCol);
        $('#del-row').addEventListener('click', delParamExcelRow);
        $('#del-column').addEventListener('click', delParamExcelCol);
        $('#clear-table').addEventListener('click', clearParamExcelTable);
        $('#export-table').addEventListener('click', exportParamExcelTable);
        $('#import-table-btn').addEventListener('click', () => $('#import-table').click());
        $('#import-table').addEventListener('change', importParamExcelTableFile);

        // çµæœæ“ä½œæŒ‰éˆ•
        $('#copy-results').addEventListener('click', copyAllResults);
        $('#clear-results').addEventListener('click', clearAllResults);

        function copyAllResults() {
            const container = document.getElementById('status-container');
            if (!container || !container.innerText.trim()) {
                alert('æ²’æœ‰å¯è¤‡è£½çš„çµæœ');
                return;
            }
            navigator.clipboard.writeText(container.innerText).then(() => {
                const btn = $('#copy-results');
                btn.innerHTML = '<i class="bi bi-check-lg"></i>';
                setTimeout(() => { btn.innerHTML = '<i class="bi bi-clipboard"></i>'; }, 1500);
            }).catch(() => {
                alert('è¤‡è£½å¤±æ•—');
            });
        }

        function clearAllResults() {
            const container = document.getElementById('status-container');
            if (container) {
                container.innerHTML = '';
            }
            // é‡ç½®é€²åº¦æ¢
            elements.totalProgress.style.width = '0%';
            elements.totalProgress.textContent = '';
        }
        $('#request-method').addEventListener('change', e => { $('#post-config').hidden = e.target.value !== 'POST'; saveConfig(); });
        $('#toggle-advanced').addEventListener('click', () => $('#advanced-settings').classList.toggle('show'));
        $('#enable-auth').addEventListener('change', e => {
            const authConfig = $('#auth-config');
            authConfig.hidden = !e.target.checked;
            const authType = $('#auth-type').value;
            $('#basic-auth-fields').hidden = !(e.target.checked && authType === 'Basic');
            $('#bearer-auth-field').hidden = !(e.target.checked && authType === 'Bearer');
            saveConfig();
        });
        $('#auth-type').addEventListener('change', e => {
            const enableAuth = $('#enable-auth').checked;
            $('#basic-auth-fields').hidden = !(enableAuth && e.target.value === 'Basic');
            $('#bearer-auth-field').hidden = !(enableAuth && e.target.value === 'Bearer');
            saveConfig();
        });
        ['url-template', 'post-body-template', 'request-delay', 'auth-username', 'auth-password', 'auth-token'].forEach(id => {
            $('#' + id).addEventListener('input', saveConfig);
        });

        // éµç›¤å°èˆª
        document.addEventListener('keydown', function (e) {
            // ä¸»é …è¡¨æ ¼éµç›¤å°èˆª
            if (selectedMainCell) {
                const row = parseInt(selectedMainCell.dataset.row);
                const col = parseInt(selectedMainCell.dataset.col);

                switch (e.key) {
                    case 'Tab':
                        e.preventDefault();
                        if (e.shiftKey) {
                            // å‘å·¦ç§»å‹•
                            if (col > 0) {
                                const inputs = document.querySelectorAll('.main-excel-input');
                                const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                                inputs[currentIndex - 1].focus();
                            }
                        } else {
                            // å‘å³ç§»å‹•
                            if (col < mainExcelData[0].length - 1) {
                                const inputs = document.querySelectorAll('.main-excel-input');
                                const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                                inputs[currentIndex + 1].focus();
                            } else {
                                // å¦‚æœæ˜¯æœ€å¾Œä¸€åˆ—ï¼Œæ–°å¢ä¸€åˆ—ä¸¦ç§»å‹•åˆ°æ–°åˆ—
                                const currentRow = row;
                                addMainExcelCol();
                                setTimeout(() => {
                                    // ä½¿ç”¨è¡Œåˆ—ä½ç½®ä¾†å®šä½æ–°çš„inputå…ƒç´ 
                                    const newInput = document.querySelector(`.main-excel-input[data-row="${currentRow}"][data-col="${mainExcelData[0].length - 1}"]`);
                                    if (newInput) {
                                        newInput.focus();
                                    }
                                }, 100);
                            }
                        }
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (row < mainExcelData.length - 1) {
                            const inputs = document.querySelectorAll('.main-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                            inputs[currentIndex + mainExcelData[0].length].focus();
                        } else {
                            // å¦‚æœæ˜¯æœ€å¾Œä¸€è¡Œï¼Œæ–°å¢ä¸€è¡Œä¸¦ç§»å‹•åˆ°æ–°è¡ŒåŒä¸€åˆ—
                            const currentCol = col;
                            addMainExcelRow();
                            setTimeout(() => {
                                // ä½¿ç”¨è¡Œåˆ—ä½ç½®ä¾†å®šä½æ–°çš„inputå…ƒç´ 
                                const newInput = document.querySelector(`.main-excel-input[data-row="${mainExcelData.length - 1}"][data-col="${currentCol}"]`);
                                if (newInput) {
                                    newInput.focus();
                                }
                            }, 100);
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        if (row > 0) {
                            const inputs = document.querySelectorAll('.main-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                            inputs[currentIndex - mainExcelData[0].length].focus();
                        }
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        if (row < mainExcelData.length - 1) {
                            const inputs = document.querySelectorAll('.main-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                            inputs[currentIndex + mainExcelData[0].length].focus();
                        }
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        if (col > 0) {
                            const inputs = document.querySelectorAll('.main-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                            inputs[currentIndex - 1].focus();
                        }
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        if (col < mainExcelData[0].length - 1) {
                            const inputs = document.querySelectorAll('.main-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedMainCell);
                            inputs[currentIndex + 1].focus();
                        }
                        break;
                }
            }
            // åƒæ•¸è¡¨æ ¼éµç›¤å°èˆª
            else if (selectedParamCell) {
                const row = parseInt(selectedParamCell.dataset.row);
                const col = parseInt(selectedParamCell.dataset.col);

                switch (e.key) {
                    case 'Tab':
                        e.preventDefault();
                        if (e.shiftKey) {
                            // å‘å·¦ç§»å‹•
                            if (col > 0) {
                                const inputs = document.querySelectorAll('.param-excel-input');
                                const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                                inputs[currentIndex - 1].focus();
                            }
                        } else {
                            // å‘å³ç§»å‹•
                            if (col < paramExcelData[0].length - 1) {
                                const inputs = document.querySelectorAll('.param-excel-input');
                                const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                                inputs[currentIndex + 1].focus();
                            } else {
                                // å¦‚æœæ˜¯æœ€å¾Œä¸€åˆ—ï¼Œæ–°å¢ä¸€åˆ—ä¸¦ç§»å‹•åˆ°æ–°åˆ—
                                const currentRow = row;
                                addParamExcelCol();
                                setTimeout(() => {
                                    // ä½¿ç”¨è¡Œåˆ—ä½ç½®ä¾†å®šä½æ–°çš„inputå…ƒç´ 
                                    const newInput = document.querySelector(`.param-excel-input[data-row="${currentRow}"][data-col="${paramExcelData[0].length - 1}"]`);
                                    if (newInput) {
                                        newInput.focus();
                                    }
                                }, 100);
                            }
                        }
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (row < paramExcelData.length - 1) {
                            const inputs = document.querySelectorAll('.param-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                            inputs[currentIndex + paramExcelData[0].length].focus();
                        } else {
                            // å¦‚æœæ˜¯æœ€å¾Œä¸€è¡Œï¼Œæ–°å¢ä¸€è¡Œä¸¦ç§»å‹•åˆ°æ–°è¡ŒåŒä¸€åˆ—
                            const currentCol = col;
                            addParamExcelRow();
                            setTimeout(() => {
                                // ä½¿ç”¨è¡Œåˆ—ä½ç½®ä¾†å®šä½æ–°çš„inputå…ƒç´ 
                                const newInput = document.querySelector(`.param-excel-input[data-row="${paramExcelData.length - 1}"][data-col="${currentCol}"]`);
                                if (newInput) {
                                    newInput.focus();
                                }
                            }, 100);
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        if (row > 0) {
                            const inputs = document.querySelectorAll('.param-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                            inputs[currentIndex - paramExcelData[0].length].focus();
                        }
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        if (row < paramExcelData.length - 1) {
                            const inputs = document.querySelectorAll('.param-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                            inputs[currentIndex + paramExcelData[0].length].focus();
                        }
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        if (col > 0) {
                            const inputs = document.querySelectorAll('.param-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                            inputs[currentIndex - 1].focus();
                        }
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        if (col < paramExcelData[0].length - 1) {
                            const inputs = document.querySelectorAll('.param-excel-input');
                            const currentIndex = Array.from(inputs).indexOf(selectedParamCell);
                            inputs[currentIndex + 1].focus();
                        }
                        break;
                }
            }
        });

        // ä¸»é …è¡¨æ ¼è¤‡è£½è²¼ä¸Šè™•ç†
        $('#main-excel-table').addEventListener('paste', function (e) {
            if (selectedMainCell) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text');
                const lines = pastedData.split('\n');

                let startRow = parseInt(selectedMainCell.dataset.row);
                let startCol = parseInt(selectedMainCell.dataset.col);

                const validLines = lines.filter(line => line.trim() !== '');

                if (validLines.length === 0) {
                    return;
                }

                validLines.forEach((line, rowOffset) => {
                    const cells = line.split('\t');
                    const currentRow = startRow + rowOffset;

                    while (currentRow >= mainExcelData.length) {
                        addMainExcelRow();
                    }

                    cells.forEach((cell, colOffset) => {
                        const currentCol = startCol + colOffset;

                        while (currentCol >= mainExcelData[0].length) {
                            addMainExcelCol();
                        }

                        if (mainExcelData[currentRow] && mainExcelData[currentRow][currentCol] !== undefined) {
                            mainExcelData[currentRow][currentCol] = cell.trim();
                        }
                    });
                });

                renderMainExcelTable();
                saveConfig();
            }
        });

        // åƒæ•¸è¡¨æ ¼è¤‡è£½è²¼ä¸Šè™•ç†
        $('#excel-table').addEventListener('paste', function (e) {
            if (selectedParamCell) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text');
                const lines = pastedData.split('\n');

                let startRow = parseInt(selectedParamCell.dataset.row);
                let startCol = parseInt(selectedParamCell.dataset.col);

                const validLines = lines.filter(line => line.trim() !== '');

                if (validLines.length === 0) {
                    return;
                }

                validLines.forEach((line, rowOffset) => {
                    const cells = line.split('\t');
                    const currentRow = startRow + rowOffset;

                    while (currentRow >= paramExcelData.length) {
                        addParamExcelRow();
                    }

                    cells.forEach((cell, colOffset) => {
                        const currentCol = startCol + colOffset;

                        while (currentCol >= paramExcelData[0].length) {
                            addParamExcelCol();
                        }

                        if (paramExcelData[currentRow] && paramExcelData[currentRow][currentCol] !== undefined) {
                            paramExcelData[currentRow][currentCol] = cell.trim();
                        }
                    });
                });

                renderParamExcelTable();
                saveConfig();
            }
        });

        $('#send-request').addEventListener('click', async () => {
            const method = $('#request-method').value;
            const delay = parseInt($('#request-delay').value) || 0;

            if (!mainExcelData.length || !paramExcelData.length) {
                elements.statusContainer.innerHTML = '<div class="alert alert-warning">è«‹è¨­ç½®ä¸»é …è¡¨æ ¼å’Œåƒæ•¸è¡¨æ ¼</div>';
                return;
            }

            elements.statusContainer.innerHTML = '';
            let count = 0;
            const total = mainExcelData.length * paramExcelData.length;

            // æ¸…é™¤æ‰€æœ‰è¡¨æ ¼è¡Œé«˜äº®
            clearTableHighlight();

            // æ›´æ–°åŸ·è¡Œé€²åº¦æ¨™é¡Œ
            document.querySelector('#total-progress').previousElementSibling.textContent = `ğŸ“Š åŸ·è¡Œé€²åº¦ (ğŸ”„ å¤–å±¤å¾ªç’°: ${mainExcelData.length} è¡Œä¸»é … | ğŸ” å…§å±¤å¾ªç’°: ${paramExcelData.length} è¡Œåƒæ•¸ | ğŸš€ ç¸½è«‹æ±‚æ•¸: 0/${total})`;

            // æ­¥é©Ÿ5ï¼šåŸ·è¡Œè«‹æ±‚ä¸¦é¡¯ç¤ºçµæœ
            for (let i = 0; i < mainExcelData.length; i++) {
                const mainRowData = mainExcelData[i];
                const mainParams = {};

                // è¨­ç½®ä¸»é …åƒæ•¸
                mainRowData.forEach((value, k) => mainParams[`MainItem${k + 1}`] = value);

                // é¡¯ç¤ºä¸»é …è³‡è¨Š (å¤–å±¤å¾ªç’°)
                const mainItemsDisplay = mainRowData.map((item, idx) => `ä¸»é …${idx + 1}: ${item}`).join(', ');

                for (let j = 0; j < paramExcelData.length; j++) {
                    const paramRowData = paramExcelData[j];
                    const allParams = { ...mainParams };

                    // è¨­ç½®åƒæ•¸çµ„åƒæ•¸
                    paramRowData.forEach((value, k) => allParams[`Parameter${k + 1}`] = value);

                    // æ›´æ–°è¡¨æ ¼è¡Œé«˜äº®æŒ‡ç¤ºç•¶å‰æ­£åœ¨è™•ç†çš„è¡Œ
                    updateTableHighlight(i, j);

                    const statusItem = elements.statusContainer.appendChild(document.createElement('div'));
                    statusItem.className = 'status-item';
                    statusItem.innerHTML = `
                        <div class="request-info">
                            <div class="request-title">
                                ğŸ“¡
                                è«‹æ±‚ ${count + 1}/${total}
                                <span class="loop-badge">
                                    <span class="outer-loop">ğŸ”„ å¤–å±¤ ${i + 1}</span>
                                    <span class="inner-loop">ğŸ” å…§å±¤ ${j + 1}</span>
                                </span>
                            </div>
                            <div class="request-details">
                                ğŸ“‹ ä¸»é …: ${mainItemsDisplay} | ğŸ›ï¸ åƒæ•¸: ${paramRowData.map((item, idx) => `åƒæ•¸${idx + 1}: ${item}`).join(', ')}
                            </div>
                        </div>
                        <div class="progress"><div class="progress-bar" style="width: 50%;"></div></div>
                        <div class="result-container mt-2"></div>
                    `;

                    // æ·»åŠ æ–°é …ç›®å¾Œç«‹å³æ»¾å‹•åˆ°æœ€æ–°é …ç›®
                    setTimeout(() => {
                        scrollToBottom();
                    }, 50);
                    const progress = statusItem.querySelector('.progress-bar');
                    const resultContainer = statusItem.querySelector('.result-container');

                    let url = $('#url-template').value;
                    let body;

                    // æ›¿æ›URLä¸­çš„å ä½ç¬¦
                    for (const [key, val] of Object.entries(allParams)) {
                        url = url.replace(new RegExp(`{${key}}`, 'g'), encodeURIComponent(val));
                    }

                    // é¡¯ç¤ºè«‹æ±‚è©³ç´°ä¿¡æ¯
                    let requestInfo = `<div class="request-url expandable-text">ğŸŒ ${url}</div>`;

                    if (method === 'POST') {
                        let postBodyTemplate = $('#post-body-template').value;
                        // æ›¿æ›POSTè«‹æ±‚é«”ä¸­çš„å ä½ç¬¦
                        for (const [key, val] of Object.entries(allParams)) {
                            postBodyTemplate = postBodyTemplate.replace(new RegExp(`{${key}}`, 'g'), val);
                        }
                        body = JSON.parse(postBodyTemplate);
                        const bodyText = JSON.stringify(body);
                        requestInfo += `<div class="request-body expandable-text">ğŸ“¦ è³‡æ–™: ${bodyText}</div>`;
                    }

                    resultContainer.innerHTML = requestInfo;

                    const response = await sendRequest(method, url, body);
                    progress.style.width = '100%';
                    progress.classList.add(response.success ? 'bg-success' : 'bg-danger');
                    statusItem.classList.add(response.success ? 'status-success' : 'status-error');
                    const formatted = formatResult(response.success ? `âœ… æˆåŠŸï¼š${response.data}` : `âŒ å¤±æ•—ï¼š${response.error}`, response.success);
                    resultContainer.innerHTML += `<div class="result ${response.success ? 'success' : 'error'}">${formatted.short}</div>`;
                    resultContainer.dataset.full = formatted.full;

                    count++;
                    elements.totalProgress.style.width = `${(count / total) * 100}%`;

                    // æ›´æ–°åŸ·è¡Œé€²åº¦æ¨™é¡Œé¡¯ç¤ºç•¶å‰è«‹æ±‚æ•¸
                    document.querySelector('#total-progress').previousElementSibling.textContent = `ğŸ“Š åŸ·è¡Œé€²åº¦ (ğŸ”„ å¤–å±¤å¾ªç’°: ${mainExcelData.length} è¡Œä¸»é … | ğŸ” å…§å±¤å¾ªç’°: ${paramExcelData.length} è¡Œåƒæ•¸ | ğŸš€ ç¸½è«‹æ±‚æ•¸: ${count}/${total})`;

                    // è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°çš„çµæœ
                    scrollToBottom();

                    if (delay) await new Promise(resolve => setTimeout(resolve, delay));
                }
            }

            // æ‰€æœ‰è«‹æ±‚å®Œæˆå¾Œæ¸…é™¤è¡¨æ ¼è¡Œé«˜äº®
            clearTableHighlight();
        });

        elements.statusContainer.addEventListener('click', e => {
            if (e.target.classList.contains('result')) {
                const container = e.target.parentElement;
                e.target.textContent = e.target.textContent.includes('é»æ“Šå±•é–‹') ? container.dataset.full : formatResult(container.dataset.full, e.target.classList.contains('success')).short;
            }
        });

        $('#clear-storage').addEventListener('click', clearConfig);
        $('#export-config').addEventListener('click', exportConfig);
        $('#import-config-btn').addEventListener('click', () => $('#import-config').click());
        $('#import-config').addEventListener('change', importConfig);

        function $(selector) { return document.getElementById(selector.replace('#', '')); }

        // è‡ªå‹•æ»¾å‹•åŠŸèƒ½ç®¡ç†
        let autoScrollEnabled = true;
        let scrollTimeout = null;

        // è‡ªå‹•æ»¾å‹•åˆ°è«‹æ±‚çµæœå€åŸŸåº•éƒ¨
        function scrollToBottom() {
            if (!autoScrollEnabled) return;

            const requestStatusContainer = document.querySelector('.request-status');
            if (requestStatusContainer) {
                requestStatusContainer.scrollTo({
                    top: requestStatusContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }
        }

        // æ›´æ–°æ»¾å‹•æŒ‡ç¤ºå™¨
        function updateScrollIndicator() {
            const indicator = document.getElementById('scroll-indicator');
            if (indicator) {
                if (autoScrollEnabled) {
                    indicator.innerHTML = '<i class="bi bi-arrow-down-circle"></i>';
                    indicator.className = 'btn btn-outline-success btn-sm';
                    indicator.title = 'è‡ªå‹•æ»¾å‹•é–‹å•Ÿä¸­ (é»æ“Šæš«åœ)';
                } else {
                    indicator.innerHTML = '<i class="bi bi-pause-circle"></i>';
                    indicator.className = 'btn btn-outline-secondary btn-sm';
                    indicator.title = 'è‡ªå‹•æ»¾å‹•å·²æš«åœ (é»æ“Šé–‹å•Ÿ)';
                }
            }
        }

        // è¨­ç½®æ»¾å‹•äº‹ä»¶ç›£è½å™¨ä¾†æª¢æ¸¬ç”¨æˆ¶æ‰‹å‹•æ»¾å‹•
        function setupScrollListener() {
            const requestStatusContainer = document.querySelector('.request-status');
            if (requestStatusContainer) {
                requestStatusContainer.addEventListener('scroll', function () {
                    // æª¢æŸ¥æ˜¯å¦æ»¾å‹•åˆ°åº•éƒ¨
                    const isAtBottom = this.scrollTop + this.clientHeight >= this.scrollHeight - 5;

                    if (isAtBottom) {
                        // å¦‚æœåœ¨åº•éƒ¨ï¼Œå•Ÿç”¨è‡ªå‹•æ»¾å‹•
                        if (!autoScrollEnabled) {
                            autoScrollEnabled = true;
                            updateScrollIndicator();
                        }
                    } else {
                        // å¦‚æœä¸åœ¨åº•éƒ¨ï¼Œæš«åœè‡ªå‹•æ»¾å‹• (ä½†ä¸è¨­ç½®è‡ªå‹•æ¢å¾©ï¼Œäº¤ç”±ç”¨æˆ¶æ§åˆ¶æˆ–æ»¾å‹•åˆ°åº•éƒ¨æ¢å¾©)
                        if (autoScrollEnabled) {
                            autoScrollEnabled = false;
                            updateScrollIndicator();
                        }
                    }
                });
            }
        }

        // ç¶å®šæ»¾å‹•æŒ‡ç¤ºå™¨æŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.getElementById('scroll-indicator') && document.getElementById('scroll-indicator').addEventListener('click', () => {
            autoScrollEnabled = !autoScrollEnabled;
            updateScrollIndicator();
            if (autoScrollEnabled) {
                scrollToBottom();
            }
        });

        // æ”¹å–„æ–‡æœ¬é¡¯ç¤ºçš„åŠŸèƒ½
        function formatText(text, maxLength = 80) {
            if (!text || text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function createExpandableElement(element) {
            const originalText = element.textContent;
            const shortText = formatText(originalText);

            if (originalText.length <= 80) return;

            element.textContent = shortText;
            element.title = 'é»æ“Šå±•é–‹å®Œæ•´å…§å®¹';
            element.style.cursor = 'pointer';

            element.addEventListener('click', function () {
                if (this.textContent.includes('...')) {
                    this.textContent = originalText;
                    this.title = 'é»æ“Šç¸®çŸ­å…§å®¹';
                } else {
                    this.textContent = shortText;
                    this.title = 'é»æ“Šå±•é–‹å®Œæ•´å…§å®¹';
                }
            });
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œè™•ç†æ‰€æœ‰å¯å±•é–‹çš„æ–‡æœ¬
        document.addEventListener('DOMContentLoaded', function () {
            const expandableElements = document.querySelectorAll('.expandable-text');
            expandableElements.forEach(createExpandableElement);
        });

        // é›™é‡å¾ªç’°å‹•ç•«æ§åˆ¶
        let animationRunning = false;
        let animationInterval = null;

        function startLoopAnimation() {
            if (animationRunning) return;

            animationRunning = true;
            let currentMainIndex = 0;
            let currentParamIndex = 0;
            const totalMainItems = 3;
            const totalParamItems = 3;

            function updateAnimation() {
                // æ¸…é™¤æ‰€æœ‰activeç‹€æ…‹
                document.querySelectorAll('.loop-item').forEach(item => {
                    item.classList.remove('active');
                });

                // è¨­ç½®ç•¶å‰ä¸»é …ç‚ºactive
                const mainItem = document.querySelector(`[data-main-index="${currentMainIndex}"]`);
                if (mainItem) {
                    mainItem.classList.add('active');
                }

                // è¨­ç½®ç•¶å‰åƒæ•¸çµ„ç‚ºactive
                const paramItem = document.querySelector(`[data-param-index="${currentParamIndex}"]`);
                if (paramItem) {
                    paramItem.classList.add('active');
                }

                // è¨ˆç®—ç•¶å‰è«‹æ±‚ç·¨è™Ÿ
                const requestIndex = currentMainIndex * totalParamItems + currentParamIndex;

                // æ›´æ–°æ‰€æœ‰è«‹æ±‚é …ç›®çš„æ–‡æœ¬
                document.querySelectorAll('.request-text').forEach((text, index) => {
                    const baseRequestNum = currentMainIndex * totalParamItems + index + 1;
                    text.textContent = `ğŸ“¡ è«‹æ±‚${baseRequestNum}`;
                });

                // è¨­ç½®ç•¶å‰è«‹æ±‚ç‚ºactive
                const requestItem = document.querySelector(`[data-request-index="${currentParamIndex}"]`);
                if (requestItem) {
                    requestItem.classList.add('active');
                }

                // æ›´æ–°ç‹€æ…‹æ–‡æœ¬
                const statusElement = document.getElementById('loop-status');
                if (statusElement) {
                    statusElement.textContent = `ä¸»é …è¡Œ${currentMainIndex + 1} Ã— åƒæ•¸çµ„${currentParamIndex + 1} = è«‹æ±‚${requestIndex + 1}`;
                }

                // æ›´æ–°ç´¢å¼•
                currentParamIndex++;
                if (currentParamIndex >= totalParamItems) {
                    currentParamIndex = 0;
                    currentMainIndex++;
                    if (currentMainIndex >= totalMainItems) {
                        currentMainIndex = 0;
                    }
                }
            }

            // ç«‹å³åŸ·è¡Œä¸€æ¬¡
            updateAnimation();

            // æ¯2ç§’æ›´æ–°ä¸€æ¬¡å‹•ç•«
            animationInterval = setInterval(updateAnimation, 2000);
        }

        function stopLoopAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            animationRunning = false;

            // æ¸…é™¤æ‰€æœ‰activeç‹€æ…‹
            document.querySelectorAll('.loop-item').forEach(item => {
                item.classList.remove('active');
            });

            // é‡ç½®è«‹æ±‚æ–‡æœ¬
            document.querySelectorAll('.request-text').forEach((text, index) => {
                text.textContent = `ğŸ“¡ è«‹æ±‚${index + 1}`;
            });

            // é‡ç½®ç‹€æ…‹æ–‡æœ¬
            const statusElement = document.getElementById('loop-status');
            if (statusElement) {
                statusElement.textContent = 'ä¸»é …è¡Œ1 Ã— åƒæ•¸çµ„1 = è«‹æ±‚1';
            }
        }

        // ç•¶é é¢åŠ è¼‰å®Œæˆå¾Œå•Ÿå‹•å‹•ç•«
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();

            // è¨­ç½®æ»¾å‹•ç›£è½å™¨
            setupScrollListener();

            // åˆå§‹åŒ–æ»¾å‹•æŒ‡ç¤ºå™¨
            updateScrollIndicator();

            // ç«‹å³å•Ÿå‹•å‹•ç•«
            setTimeout(() => {
                startLoopAnimation();
            }, 500);
        });

        // ç•¶ç”¨æˆ¶é»æ“Šå¾ªç’°ç¤ºæ„åœ–æ™‚åˆ‡æ›å‹•ç•«
        document.addEventListener('click', (e) => {
            if (e.target.closest('.loop-diagram')) {
                if (animationRunning) {
                    stopLoopAnimation();
                    // æ›´æ–°æç¤ºæ–‡å­—
                    const titleElement = e.target.closest('.card').querySelector('.card-title small');
                    if (titleElement) {
                        titleElement.textContent = '(é»æ“Šç¹¼çºŒå‹•ç•«)';
                    }
                    const diagramElement = e.target.closest('.loop-diagram');
                    if (diagramElement) {
                        diagramElement.title = 'é»æ“Šç¹¼çºŒå‹•ç•«';
                    }
                } else {
                    startLoopAnimation();
                    // æ›´æ–°æç¤ºæ–‡å­—
                    const titleElement = e.target.closest('.card').querySelector('.card-title small');
                    if (titleElement) {
                        titleElement.textContent = '(é»æ“Šæš«åœå‹•ç•«)';
                    }
                    const diagramElement = e.target.closest('.loop-diagram');
                    if (diagramElement) {
                        diagramElement.title = 'é»æ“Šæš«åœå‹•ç•«';
                    }
                }
            }
        });
    </script>
</body>

</html>
